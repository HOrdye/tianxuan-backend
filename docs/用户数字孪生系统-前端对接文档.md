# ç”¨æˆ·æ•°å­—å­ªç”Ÿç³»ç»Ÿ - å‰ç«¯å¯¹æ¥æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2026-01-31  
**åç«¯çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ  
**API æ–‡æ¡£åœ°å€**ï¼š`http://localhost:3000/api-docs`

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [åŸºç¡€ä¿¡æ¯](#åŸºç¡€ä¿¡æ¯)
3. [è®¤è¯è¯´æ˜](#è®¤è¯è¯´æ˜)
4. [API æ¥å£åˆ—è¡¨](#api-æ¥å£åˆ—è¡¨)
5. [æ•°æ®ç±»å‹å®šä¹‰](#æ•°æ®ç±»å‹å®šä¹‰)
6. [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
7. [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¦‚è¿°

ç”¨æˆ·æ•°å­—å­ªç”Ÿç³»ç»Ÿæä¾›äº†ä¸€å¥—å®Œæ•´çš„ç”¨æˆ·ä¸Šä¸‹æ–‡ç®¡ç† APIï¼ŒåŒ…æ‹¬ï¼š

- **å‘½ä¸»ååˆº**ï¼šç”¨æˆ·çš„æ˜¾æ€§å±‚ä¿¡æ¯ï¼ˆMBTIã€èŒä¸šã€ç°çŠ¶ã€æ„¿æ™¯ç­‰ï¼‰
- **èµ„æ–™å®Œæ•´åº¦**ï¼šè®¡ç®—å’Œå±•ç¤ºç”¨æˆ·èµ„æ–™å®Œæ•´åº¦ï¼Œæ”¯æŒå¥–åŠ±æœºåˆ¶
- **éšæ€§ä¿¡æ¯**ï¼šç³»ç»Ÿæ¨æ–­çš„ç”¨æˆ·ç‰¹å¾ï¼ˆè§’è‰²ã€å…´è¶£ã€é£é™©åå¥½ç­‰ï¼‰
- **ç”Ÿè¾°ä¿¡æ¯åŒæ­¥**ï¼šè‡ªåŠ¨åŒæ­¥ç”Ÿè¾°ä¿¡æ¯åˆ°ç”¨æˆ·ä¸Šä¸‹æ–‡

---

## åŸºç¡€ä¿¡æ¯

### Base URL

```
å¼€å‘ç¯å¢ƒ: http://localhost:3000/api
ç”Ÿäº§ç¯å¢ƒ: https://api.yourdomain.com/api
```

### å“åº”æ ¼å¼

æ‰€æœ‰ API å“åº”ç»Ÿä¸€ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š

```typescript
// æˆåŠŸå“åº”
{
  success: true,
  data: { ... },        // å“åº”æ•°æ®
  message?: string      // å¯é€‰çš„æˆåŠŸæ¶ˆæ¯
}

// é”™è¯¯å“åº”
{
  success: false,
  error: string,        // é”™è¯¯ä»£ç 
  message?: string      // é”™è¯¯æè¿°
}
```

### HTTP çŠ¶æ€ç 

- `200` - æˆåŠŸ
- `400` - å‚æ•°é”™è¯¯
- `401` - æœªè®¤è¯
- `404` - èµ„æºä¸å­˜åœ¨
- `500` - æœåŠ¡å™¨é”™è¯¯

---

## è®¤è¯è¯´æ˜

### è®¤è¯æ–¹å¼

æ‰€æœ‰æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ JWT Tokenï¼š

```
Authorization: Bearer <token>
```

### è·å– Token

é€šè¿‡ç™»å½•æ¥å£è·å– Tokenï¼š

```typescript
// POST /api/auth/login
const response = await fetch('/api/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    email: 'user@example.com',
    password: 'password123'
  })
});

const { data } = await response.json();
const token = data.token;
```

### Token å­˜å‚¨

å»ºè®®å°† Token å­˜å‚¨åœ¨ï¼š
- **Web**: `localStorage` æˆ– `sessionStorage`
- **ç§»åŠ¨ç«¯**: å®‰å…¨å­˜å‚¨ï¼ˆKeychain/Keystoreï¼‰

---

## API æ¥å£åˆ—è¡¨

### 1. è·å–å‘½ä¸»ååˆº

**æ¥å£**ï¼š`GET /api/user/destiny-card`

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer <token>
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "mbti": "INTJ",
    "currentStatus": "åˆšè¢«è£å‘˜ï¼Œæƒ³åˆ›ä¸š",
    "identity": "ç´«å¾®ä¸ƒæ€Â·åŒ–æ€ä¸ºæƒ",
    "profession": "ç‹¬ç«‹å¼€å‘è€…",
    "wishes": ["è´¢åŠ¡è‡ªç”±", "å®¶åº­å’Œç¦"],
    "energyLevel": "balanced",
    "completeness": 60,
    "lastUpdated": "2026-01-31T12:00:00.000Z"
  }
}
```

**TypeScript ç±»å‹**ï¼š
```typescript
interface DestinyCard {
  mbti?: string;
  currentStatus?: string;
  identity?: string;
  profession?: string;
  wishes?: string[];
  energyLevel?: 'strong' | 'weak' | 'balanced';
  completeness: number;        // 0-100
  lastUpdated: string;          // ISO 8601 æ—¥æœŸå­—ç¬¦ä¸²
}
```

---

### 2. æ›´æ–°å‘½ä¸»ååˆº

**æ¥å£**ï¼š`PUT /api/user/destiny-card`

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer <token>
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼ˆæ‰€æœ‰å­—æ®µå¯é€‰ï¼‰ï¼š
```json
{
  "mbti": "INTJ",
  "profession": "è½¯ä»¶å·¥ç¨‹å¸ˆ",
  "currentStatus": "åˆšè¢«è£å‘˜ï¼Œæƒ³åˆ›ä¸š",
  "wishes": ["è´¢åŠ¡è‡ªç”±", "å®¶åº­å’Œç¦"],
  "energyLevel": "balanced",
  "identity": "ç´«å¾®ä¸ƒæ€Â·åŒ–æ€ä¸ºæƒ"
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "å‘½ä¸»ååˆºå·²æ›´æ–°",
  "data": {
    "mbti": "INTJ",
    "profession": "è½¯ä»¶å·¥ç¨‹å¸ˆ",
    "currentStatus": "åˆšè¢«è£å‘˜ï¼Œæƒ³åˆ›ä¸š",
    "wishes": ["è´¢åŠ¡è‡ªç”±", "å®¶åº­å’Œç¦"],
    "energyLevel": "balanced",
    "identity": "ç´«å¾®ä¸ƒæ€Â·åŒ–æ€ä¸ºæƒ",
    "completeness": 60,
    "lastUpdated": "2026-01-31T12:00:00.000Z",
    "events": [
      {
        "type": "COIN_GRANTED",
        "coins": 5,
        "reason": "å®Œå–„MBTIä¿¡æ¯",
        "field": "mbti"
      },
      {
        "type": "THRESHOLD_REACHED",
        "coins": 10,
        "reason": "èµ„æ–™å®Œæ•´åº¦è¾¾åˆ°30%",
        "threshold": 30
      }
    ]
  }
}
```

**é‡è¦è¯´æ˜**ï¼š
- æ›´æ–°åå¯èƒ½è¿”å› `events` æ•°ç»„ï¼ŒåŒ…å«å¥–åŠ±äº‹ä»¶
- å‰ç«¯åº”æ£€æŸ¥ `events` å¹¶æ˜¾ç¤ºå¥–åŠ±åŠ¨ç”»
- å¥–åŠ±å‘æ”¾å…·æœ‰å¹‚ç­‰æ€§ï¼Œé‡å¤æ›´æ–°ä¸ä¼šé‡å¤å‘æ”¾

**TypeScript ç±»å‹**ï¼š
```typescript
interface UpdateDestinyCardRequest {
  mbti?: string;
  profession?: string;
  currentStatus?: string;
  wishes?: string[];
  energyLevel?: 'strong' | 'weak' | 'balanced';
  identity?: string;
}

interface RewardEvent {
  type: 'COIN_GRANTED' | 'THRESHOLD_REACHED' | 'COMPLETENESS_INCREASED';
  coins?: number;
  reason: string;
  field?: string;
  threshold?: number;
}

interface UpdateDestinyCardResponse {
  // ... åŒ DestinyCard
  events?: RewardEvent[];
}
```

---

### 3. è·å–èµ„æ–™å®Œæ•´åº¦è¯¦æƒ…

**æ¥å£**ï¼š`GET /api/user/completeness`

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer <token>
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "completeness": 60,
    "breakdown": {
      "birthData": {
        "filled": true,
        "score": 40,
        "maxScore": 40
      },
      "mbti": {
        "filled": true,
        "score": 10,
        "maxScore": 10
      },
      "profession": {
        "filled": true,
        "score": 10,
        "maxScore": 10
      },
      "currentStatus": {
        "filled": false,
        "score": 0,
        "maxScore": 20
      },
      "wishes": {
        "filled": false,
        "score": 0,
        "maxScore": 20
      }
    },
    "nextRewardThreshold": 70
  }
}
```

**TypeScript ç±»å‹**ï¼š
```typescript
interface CompletenessResult {
  completeness: number;        // 0-100
  breakdown: {
    birthData: FieldScore;
    mbti: FieldScore;
    profession: FieldScore;
    currentStatus: FieldScore;
    wishes: FieldScore;
  };
  nextRewardThreshold?: number;  // ä¸‹ä¸€ä¸ªå¥–åŠ±é˜ˆå€¼
}

interface FieldScore {
  filled: boolean;
  score: number;
  maxScore: number;
}
```

**å®Œæ•´åº¦è®¡ç®—è§„åˆ™**ï¼š
- åŸºçŸ³å±‚ï¼ˆ40åˆ†ï¼‰ï¼šç”Ÿè¾°ä¿¡æ¯
- æ˜¾æ€§å±‚ï¼ˆ60åˆ†ï¼‰ï¼š
  - MBTIï¼ˆ10åˆ†ï¼‰
  - èŒä¸šï¼ˆ10åˆ†ï¼‰
  - ç°çŠ¶æè¿°ï¼ˆ20åˆ†ï¼‰
  - æ„¿æ™¯ç›®æ ‡ï¼ˆ20åˆ†ï¼‰

---

### 4. åŒæ­¥ç”Ÿè¾°ä¿¡æ¯åˆ°ç”¨æˆ·ä¸Šä¸‹æ–‡

**æ¥å£**ï¼š`POST /api/user/sync-birthday-to-context`

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer <token>
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "birthday": "1990-01-15",       // å¿…å¡«ï¼Œæ ¼å¼ï¼šYYYY-MM-DDï¼ˆæ¨èä½¿ç”¨ birthdayï¼‰
  "birthTime": "14:30:00",        // å¯é€‰ï¼Œæ ¼å¼ï¼šHH:mm:ss
  "birthLocation": "åŒ—äº¬å¸‚",       // å¯é€‰
  "gender": "male"                // å¯é€‰ï¼šmale, female, other
}
```

**å­—æ®µå…¼å®¹æ€§**ï¼š
- `birthday`ï¼ˆæ¨èï¼‰ï¼šä¸æ•°æ®åº“å­—æ®µåä¸€è‡´
- `birthDate`ï¼šå…¼å®¹ camelCase æ ¼å¼
- `birth_date`ï¼šå…¼å®¹ snake_case æ ¼å¼

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "ç”Ÿè¾°ä¿¡æ¯å·²åŒæ­¥åˆ°å‘½ä¸»ååˆº",
  "data": {
    "synced": true,
    "userContextUpdated": true
  }
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
- `birthday` ä¸ºå¿…å¡«å­—æ®µï¼ˆæ¨èä½¿ç”¨ `birthday`ï¼Œä¹Ÿæ”¯æŒ `birthDate` æˆ– `birth_date`ï¼‰
- åŒæ­¥åä¼šè‡ªåŠ¨æ›´æ–° `preferences.userContext.birthDate`
- å¦‚æœæ•°æ®è¢«é”å®šï¼Œä¼šè¿”å› 400 é”™è¯¯ï¼Œæç¤ºç¨åé‡è¯•

---

### 5. è·å–éšæ€§ä¿¡æ¯

**æ¥å£**ï¼š`GET /api/user/implicit-traits`

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer <token>
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "inferred_roles": ["parent", "spouse"],
    "interest_tags": ["wealth", "career", "relationship"],
    "risk_tolerance": "medium",
    "interaction_style": "detailed",
    "last_active_topic": "career",
    "family_structure": {
      "has_spouse": true,
      "has_children": true,
      "children_count": 1
    },
    "profession_hints": ["tech", "finance"]
  }
}
```

**TypeScript ç±»å‹**ï¼š
```typescript
interface ImplicitTraits {
  inferred_roles?: string[];
  interest_tags?: string[];
  risk_tolerance?: 'low' | 'medium' | 'high';
  interaction_style?: 'concise' | 'detailed';
  last_active_topic?: string;
  family_structure?: {
    has_spouse?: boolean;
    has_children?: boolean;
    children_count?: number;
  };
  profession_hints?: string[];
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
- éšæ€§ä¿¡æ¯ç”±ç³»ç»Ÿè‡ªåŠ¨æå–ï¼Œç”¨æˆ·ä¸èƒ½ç›´æ¥ä¿®æ”¹
- å¦‚æœç”¨æˆ·æ²¡æœ‰éšæ€§ä¿¡æ¯ï¼Œè¿”å›ç©ºå¯¹è±¡ `{}`

---

### 6. æ›´æ–°éšæ€§ä¿¡æ¯ï¼ˆå†…éƒ¨æ¥å£ï¼‰

**æ¥å£**ï¼š`POST /api/user/implicit-traits`

**è¯´æ˜**ï¼šæ­¤æ¥å£ä¸»è¦ç”¨äºç³»ç»Ÿå†…éƒ¨è°ƒç”¨ï¼Œå‰ç«¯é€šå¸¸ä¸éœ€è¦ç›´æ¥è°ƒç”¨ã€‚

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer <token>
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "inferred_roles": ["parent"],
  "interest_tags": ["tech", "finance"]
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "éšæ€§ä¿¡æ¯å·²æ›´æ–°",
  "data": {
    "inferred_roles": ["parent"],
    "interest_tags": ["tech", "finance"]
  }
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
- æ•°ç»„å­—æ®µä¼šè‡ªåŠ¨åˆå¹¶å¹¶å»é‡
- å¯¹è±¡å­—æ®µä¼šæ·±åº¦åˆå¹¶
- æ ‡é‡å­—æ®µä¼šè¢«æ–°å€¼è¦†ç›–

---

### 7. åˆ é™¤éšæ€§ä¿¡æ¯

**æ¥å£**ï¼š`DELETE /api/user/implicit-traits`

**è¯·æ±‚å¤´**ï¼š
```
Authorization: Bearer <token>
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼ˆå¯é€‰ï¼‰ï¼š
```json
{
  "fields": ["inferred_roles", "interest_tags"]
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "å·²åˆ é™¤æŒ‡å®šçš„éšæ€§ä¿¡æ¯",
  "data": {
    "deleted": ["inferred_roles", "interest_tags"]
  }
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
- å¦‚æœä¸æä¾› `fields` å‚æ•°ï¼Œå°†åˆ é™¤æ‰€æœ‰éšæ€§ä¿¡æ¯
- åˆ é™¤æ“ä½œä¸å¯æ¢å¤

---

### 8. è·å–ç”¨æˆ·èµ„æ–™ï¼ˆæ‰©å±•ï¼‰

**æ¥å£**ï¼š`GET /api/user/profile`

**è¯´æ˜**ï¼šæ­¤æ¥å£å·²æ‰©å±•ï¼Œç°åœ¨è¿”å› `completeness` å­—æ®µã€‚

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "email": "user@example.com",
    "username": "username",
    "completeness": 60,
    "preferences": {
      "userContext": {
        "mbti": "INTJ",
        "profession": "è½¯ä»¶å·¥ç¨‹å¸ˆ"
      }
    },
    "implicit_traits": {
      "interest_tags": ["tech"]
    }
  }
}
```

---

## æ•°æ®ç±»å‹å®šä¹‰

### å®Œæ•´ç±»å‹å®šä¹‰

```typescript
// ç”¨æˆ·ä¸Šä¸‹æ–‡æ•°æ®ï¼ˆæ˜¾æ€§å±‚ï¼‰
interface UserContextData {
  mbti?: string;
  currentStatus?: string;
  identity?: string;
  profession?: string;
  wishes?: string[];
  energyLevel?: 'strong' | 'weak' | 'balanced';
  birthDate?: string;  // ISO 8601 æ—¥æœŸå­—ç¬¦ä¸²
}

// éšæ€§ç‰¹å¾ï¼ˆéšæ€§å±‚ï¼‰
interface ImplicitTraits {
  inferred_roles?: string[];
  interest_tags?: string[];
  risk_tolerance?: 'low' | 'medium' | 'high';
  interaction_style?: 'concise' | 'detailed';
  last_active_topic?: string;
  family_structure?: {
    has_spouse?: boolean;
    has_children?: boolean;
    children_count?: number;
  };
  profession_hints?: string[];
}

// å¥–åŠ±äº‹ä»¶
interface RewardEvent {
  type: 'COIN_GRANTED' | 'THRESHOLD_REACHED' | 'COMPLETENESS_INCREASED';
  coins?: number;
  reason: string;
  field?: string;
  threshold?: number;
}

// å®Œæ•´åº¦è¯¦æƒ…
interface CompletenessResult {
  completeness: number;
  breakdown: {
    birthData: FieldScore;
    mbti: FieldScore;
    profession: FieldScore;
    currentStatus: FieldScore;
    wishes: FieldScore;
  };
  nextRewardThreshold?: number;
}

interface FieldScore {
  filled: boolean;
  score: number;
  maxScore: number;
}
```

---

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šè·å–å¹¶æ˜¾ç¤ºå‘½ä¸»ååˆº

```typescript
async function loadDestinyCard(token: string) {
  const response = await fetch('/api/user/destiny-card', {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });

  if (!response.ok) {
    throw new Error('è·å–å‘½ä¸»ååˆºå¤±è´¥');
  }

  const result = await response.json();
  if (result.success) {
    return result.data;
  }
  throw new Error(result.message || 'è·å–å¤±è´¥');
}

// ä½¿ç”¨
const card = await loadDestinyCard(token);
console.log(`å®Œæ•´åº¦ï¼š${card.completeness}%`);
console.log(`MBTIï¼š${card.mbti || 'æœªå¡«å†™'}`);
```

---

### ç¤ºä¾‹ 2ï¼šæ›´æ–°å‘½ä¸»ååˆºå¹¶å¤„ç†å¥–åŠ±

```typescript
async function updateDestinyCard(
  token: string,
  data: UpdateDestinyCardRequest
) {
  const response = await fetch('/api/user/destiny-card', {
    method: 'PUT',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  });

  if (!response.ok) {
    throw new Error('æ›´æ–°å¤±è´¥');
  }

  const result = await response.json();
  if (result.success) {
    // æ£€æŸ¥æ˜¯å¦æœ‰å¥–åŠ±äº‹ä»¶
    if (result.data.events && result.data.events.length > 0) {
      result.data.events.forEach((event: RewardEvent) => {
        if (event.type === 'COIN_GRANTED' && event.coins) {
          // æ˜¾ç¤ºå¥–åŠ±åŠ¨ç”»
          showRewardAnimation(event.coins, event.reason);
        }
      });
    }
    return result.data;
  }
  throw new Error(result.message || 'æ›´æ–°å¤±è´¥');
}

// ä½¿ç”¨
const updated = await updateDestinyCard(token, {
  mbti: 'INTJ',
  profession: 'è½¯ä»¶å·¥ç¨‹å¸ˆ'
});
```

---

### ç¤ºä¾‹ 3ï¼šæ˜¾ç¤ºå®Œæ•´åº¦è¿›åº¦æ¡

```typescript
async function loadCompleteness(token: string) {
  const response = await fetch('/api/user/completeness', {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });

  const result = await response.json();
  if (result.success) {
    const { completeness, breakdown, nextRewardThreshold } = result.data;
    
    // æ˜¾ç¤ºæ€»ä½“å®Œæ•´åº¦
    updateProgressBar(completeness);
    
    // æ˜¾ç¤ºå„å­—æ®µçŠ¶æ€
    Object.entries(breakdown).forEach(([field, score]) => {
      if (!score.filled) {
        showFieldHint(field, `å¡«å†™æ­¤å­—æ®µå¯è·å¾— ${score.maxScore} åˆ†`);
      }
    });
    
    // æ˜¾ç¤ºä¸‹ä¸€ä¸ªå¥–åŠ±é˜ˆå€¼
    if (nextRewardThreshold) {
      showNextRewardHint(nextRewardThreshold);
    }
  }
}
```

---

### ç¤ºä¾‹ 4ï¼šåŒæ­¥ç”Ÿè¾°ä¿¡æ¯

```typescript
async function syncBirthday(
  token: string,
  birthday: string,
  gender?: string
) {
  const response = await fetch('/api/user/sync-birthday-to-context', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      birthday,  // ä½¿ç”¨ birthdayï¼ˆä¸æ•°æ®åº“å­—æ®µåä¸€è‡´ï¼‰
      gender
    })
  });

  const result = await response.json();
  if (result.success) {
    return result.data;
  }
  
  // å¤„ç†é”™è¯¯
  if (result.error === 'INVALID_PARAMETER') {
    throw new Error('æ—¥æœŸæ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨ YYYY-MM-DD æ ¼å¼');
  }
  throw new Error(result.message || 'åŒæ­¥å¤±è´¥');
}
```

---

## æ³¨æ„äº‹é¡¹

### 1. å‚æ•°å‘½åå…¼å®¹æ€§

åç«¯åŒæ—¶æ”¯æŒå¤šç§å‚æ•°å‘½åæ ¼å¼ï¼Œä½†å»ºè®®å‰ç«¯ç»Ÿä¸€ä½¿ç”¨ä¸æ•°æ®åº“å­—æ®µåä¸€è‡´çš„æ ¼å¼ï¼š

```typescript
// âœ… æ¨èï¼šä½¿ç”¨ birthdayï¼ˆä¸æ•°æ®åº“å­—æ®µåä¸€è‡´ï¼‰
{ birthday: '1990-01-15' }

// âœ… ä¹Ÿæ”¯æŒï¼šcamelCase
{ birthDate: '1990-01-15' }

// âœ… ä¹Ÿæ”¯æŒï¼šsnake_case
{ birth_date: '1990-01-15' }
```

### 2. å¥–åŠ±äº‹ä»¶å¤„ç†

æ›´æ–°å‘½ä¸»ååˆºåï¼ŒåŠ¡å¿…æ£€æŸ¥ `events` æ•°ç»„ï¼š

```typescript
if (result.data.events) {
  result.data.events.forEach(event => {
    // æ ¹æ®äº‹ä»¶ç±»å‹æ˜¾ç¤ºä¸åŒçš„ UI åé¦ˆ
    switch (event.type) {
      case 'COIN_GRANTED':
        showCoinReward(event.coins);
        break;
      case 'THRESHOLD_REACHED':
        showThresholdReward(event.threshold, event.coins);
        break;
      case 'COMPLETENESS_INCREASED':
        showCompletenessIncrease();
        break;
    }
  });
}
```

### 3. å®Œæ•´åº¦è®¡ç®—

å®Œæ•´åº¦è®¡ç®—è§„åˆ™ï¼š
- **åŸºçŸ³å±‚ï¼ˆ40åˆ†ï¼‰**ï¼šç”Ÿè¾°ä¿¡æ¯
- **æ˜¾æ€§å±‚ï¼ˆ60åˆ†ï¼‰**ï¼š
  - MBTIï¼š10åˆ†
  - èŒä¸šï¼š10åˆ†
  - ç°çŠ¶æè¿°ï¼š20åˆ†
  - æ„¿æ™¯ç›®æ ‡ï¼š20åˆ†

å‰ç«¯åº”ç¡®ä¿è®¡ç®—é€»è¾‘ä¸åç«¯ä¸€è‡´ã€‚

### 4. å¹‚ç­‰æ€§

- å¥–åŠ±å‘æ”¾å…·æœ‰å¹‚ç­‰æ€§ï¼Œé‡å¤æ›´æ–°åŒä¸€å­—æ®µä¸ä¼šé‡å¤å‘æ”¾å¥–åŠ±
- å‰ç«¯å¯ä»¥å®‰å…¨åœ°é‡è¯•æ›´æ–°æ“ä½œ

### 5. é”™è¯¯å¤„ç†

```typescript
try {
  const result = await updateDestinyCard(token, data);
} catch (error) {
  if (error.message.includes('é”å®š')) {
    // æ•°æ®è¢«é”å®šï¼Œæç¤ºç”¨æˆ·ç¨åé‡è¯•
    showError('æ•°æ®æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨åé‡è¯•');
  } else if (error.message.includes('è®¤è¯')) {
    // Token è¿‡æœŸï¼Œé‡æ–°ç™»å½•
    redirectToLogin();
  } else {
    // å…¶ä»–é”™è¯¯
    showError(error.message);
  }
}
```

### 6. éšæ€§ä¿¡æ¯

- éšæ€§ä¿¡æ¯ç”±ç³»ç»Ÿè‡ªåŠ¨æå–ï¼Œç”¨æˆ·ä¸èƒ½ç›´æ¥ä¿®æ”¹
- å¦‚æœç”¨æˆ·æ²¡æœ‰éšæ€§ä¿¡æ¯ï¼Œ`GET /api/user/implicit-traits` è¿”å›ç©ºå¯¹è±¡ `{}`
- å‰ç«¯åº”ä¼˜é›…å¤„ç†ç©ºæ•°æ®æƒ…å†µ

---

## å¸¸è§é—®é¢˜

### Q1: æ›´æ–°å‘½ä¸»ååˆºåï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰æ”¶åˆ°å¥–åŠ±ï¼Ÿ

**A**: å¥–åŠ±åªåœ¨**é¦–æ¬¡**å¡«å†™å­—æ®µæ—¶å‘æ”¾ã€‚å¦‚æœå­—æ®µå·²ç»æœ‰å€¼ï¼Œæ›´æ–°ä¸ä¼šè§¦å‘å¥–åŠ±ã€‚æ£€æŸ¥ `events` æ•°ç»„æ˜¯å¦ä¸ºç©ºã€‚

### Q2: å®Œæ•´åº¦è®¡ç®—ä¸å‡†ç¡®ï¼Ÿ

**A**: ç¡®ä¿ï¼š
1. ç”Ÿè¾°ä¿¡æ¯æ ¼å¼æ­£ç¡®ï¼ˆYYYY-MM-DDï¼‰
2. å­—æ®µå€¼ä¸ä¸ºç©ºå­—ç¬¦ä¸²
3. `wishes` æ•°ç»„ä¸ä¸ºç©º

### Q3: åŒæ­¥ç”Ÿè¾°ä¿¡æ¯å¤±è´¥ï¼Ÿ

**A**: æ£€æŸ¥ï¼š
1. `birthday` æ ¼å¼æ˜¯å¦ä¸º `YYYY-MM-DD`ï¼ˆæ¨èä½¿ç”¨ `birthday`ï¼Œä¹Ÿæ”¯æŒ `birthDate` æˆ– `birth_date`ï¼‰
2. æ˜¯å¦æä¾›äº†å¿…å¡«å­—æ®µ
3. å¦‚æœè¿”å›"æ•°æ®è¢«é”å®š"ï¼Œç­‰å¾…å‡ ç§’åé‡è¯•

### Q4: å¦‚ä½•åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å¡«å†™äº†æŸä¸ªå­—æ®µï¼Ÿ

**A**: ä½¿ç”¨ `GET /api/user/completeness` æ¥å£ï¼Œæ£€æŸ¥ `breakdown` ä¸­å¯¹åº”å­—æ®µçš„ `filled` å±æ€§ã€‚

### Q5: å¥–åŠ±äº‹ä»¶ä»€ä¹ˆæ—¶å€™è¿”å›ï¼Ÿ

**A**: åªåœ¨æ›´æ–°å‘½ä¸»ååˆºæ—¶è¿”å›ã€‚å¦‚æœï¼š
- é¦–æ¬¡å¡«å†™å­—æ®µ â†’ è¿”å›å­—æ®µå¥–åŠ±äº‹ä»¶
- è¾¾åˆ°é˜ˆå€¼ â†’ è¿”å›é˜ˆå€¼å¥–åŠ±äº‹ä»¶
- å®Œæ•´åº¦æå‡ â†’ è¿”å›å®Œæ•´åº¦æå‡äº‹ä»¶

---

## ç›¸å…³èµ„æº

- **Swagger API æ–‡æ¡£**ï¼š`http://localhost:3000/api-docs`
- **åç«¯å¼€å‘æ–‡æ¡£**ï¼š`docs/memory-bank/ç”¨æˆ·æ•°å­—å­ªç”Ÿç³»ç»Ÿ-åç«¯å¼€å‘æŒ‡å—.md`
- **API æ¥å£è§„èŒƒ**ï¼š`docs/memory-bank/ç”¨æˆ·æ•°å­—å­ªç”Ÿç³»ç»Ÿ-APIæ¥å£è§„èŒƒ.md`

---

**æ–‡æ¡£æœ€åæ›´æ–°**ï¼š2026-01-31  
**å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»åç«¯å¼€å‘å›¢é˜Ÿ**
