# å‰ç«¯è½¬åç«¯ API éœ€æ±‚æ˜ å°„è¡¨

**åˆ›å»ºæ—¶é—´**: 2025å¹´1æœˆ30æ—¥  
**æ–‡æ¡£ç±»å‹**: å‰åç«¯APIæ˜ å°„æ¢³ç†  
**ç›®æ ‡**: æ ¹æ®å‰ç«¯"æ¥¼ç›˜æ¨¡å‹"è®¾è®¡åç«¯"æ–½å·¥å›¾çº¸"

---

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£æŒ‰ç…§**ã€Šå‰ç«¯è½¬åç«¯éœ€æ±‚æ˜ å°„æ¨¡æ¿ã€‹**è¿›è¡Œæ¢³ç†ï¼Œç›®çš„æ˜¯ï¼š
1. **é¿å…å‰åç«¯ä¸ä¸€è‡´**ï¼šå…ˆæ¢³ç†ã€å†è®¾è®¡ã€åå¼€å‘
2. **æé«˜å¼€å‘æ•ˆç‡**ï¼šé¿å…"å†™ç€å†™ç€å‘ç°å‰ç«¯è¿˜éœ€è¦ä¸€ä¸ªå‚æ•°"çš„çª˜å¢ƒ
3. **æ˜ç¡®ä¼˜å…ˆçº§**ï¼šæŒ‰ç…§ä¸šåŠ¡é‡è¦æ€§æ’åºå¼€å‘

---

## ğŸ¯ ç¬¬ä¸€æ­¥ï¼šåŠŸèƒ½æ¢³ç†ä¸ API æ˜ å°„

### æ¨¡å—1ï¼šè®¤è¯ç³»ç»Ÿ (Auth) âœ… **å·²å®Œæˆ**

| å‰ç«¯é¡µé¢/åŠŸèƒ½ | ç”¨æˆ·æ“ä½œ | å‰ç«¯éœ€è¦çš„æ•°æ® (Request) | åç«¯åº”æä¾›çš„ API (Response) | æ¶‰åŠæ•°æ®åº“è¡¨ | çŠ¶æ€ |
|-------------|---------|----------------------|---------------------------|------------|------|
| ç™»å½•é¡µé¢ | è¾“å…¥é‚®ç®±å¯†ç ç™»å½• | `{ email, password }` | `POST /api/auth/login`<br/>è¿”å›: `{ user, token }` | `auth.users` | âœ… å·²å®Œæˆ |
| æ³¨å†Œé¡µé¢ | è¾“å…¥é‚®ç®±å¯†ç æ³¨å†Œ | `{ email, password, username? }` | `POST /api/auth/register`<br/>è¿”å›: `{ user, token }` | `auth.users`, `profiles` | âœ… å·²å®Œæˆ |
| è·å–å½“å‰ç”¨æˆ· | é¡µé¢åŠ è½½æ—¶è·å–ç”¨æˆ·ä¿¡æ¯ | `Authorization: Bearer Token` | `GET /api/auth/me`<br/>è¿”å›: `{ id, email, ... }` | `auth.users`, `profiles` | âœ… å·²å®Œæˆ |

**âœ… éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•åŠŸèƒ½æ­£å¸¸
- âœ… JWT Token ç”Ÿæˆå’ŒéªŒè¯æ­£å¸¸
- âœ… å¯†ç åŠ å¯†æ ¼å¼å…¼å®¹ Supabaseï¼ˆ$2a$ æˆ– $2b$ï¼‰
- âœ… æ³¨å†Œæ—¶åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­åŒæ—¶åˆ›å»º `auth.users` å’Œ `profiles`

---

### æ¨¡å—2ï¼šç”¨æˆ·èµ„æ–™ (User Profile) âœ… **å·²å®Œæˆ**

| å‰ç«¯é¡µé¢/åŠŸèƒ½ | ç”¨æˆ·æ“ä½œ | å‰ç«¯éœ€è¦çš„æ•°æ® (Request) | åç«¯åº”æä¾›çš„ API (Response) | æ¶‰åŠæ•°æ®åº“è¡¨ | çŠ¶æ€ |
|-------------|---------|----------------------|---------------------------|------------|------|
| ä¸ªäººä¸­å¿ƒé¡µ | é¡µé¢åŠ è½½ | `Authorization: Bearer Token` | `GET /api/user/profile`<br/>è¿”å›: `{ id, email, username, tier, preferences, ... }` | `profiles` | âœ… å·²å®Œæˆ |
| ç¼–è¾‘èµ„æ–™ | æ›´æ–°ç”¨æˆ·åã€åå¥½è®¾ç½® | `{ username?, preferences? }` | `PUT /api/user/profile`<br/>è¿”å›: `{ success, data }` | `profiles` | âœ… å·²å®Œæˆ |
| è·å–ç”¨æˆ·ç­‰çº§ | æ£€æŸ¥ä¼šå‘˜ç­‰çº§ | `Authorization: Bearer Token` | `GET /api/user/tier`<br/>è¿”å›: `{ tier }` | `profiles` | âœ… å·²å®Œæˆ |

**âœ… éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… è·å–ç”¨æˆ·èµ„æ–™åŠŸèƒ½æ­£å¸¸
- âœ… æ›´æ–°ç”¨æˆ·èµ„æ–™åŠŸèƒ½æ­£å¸¸
- âœ… æƒé™éªŒè¯ï¼ˆåªèƒ½ä¿®æ”¹è‡ªå·±çš„èµ„æ–™ï¼‰

---

### æ¨¡å—3ï¼šè®¢é˜…/ä¼šå‘˜ç³»ç»Ÿ (Subscription) âœ… **å·²å®Œæˆ**

| å‰ç«¯é¡µé¢/åŠŸèƒ½ | ç”¨æˆ·æ“ä½œ | å‰ç«¯éœ€è¦çš„æ•°æ® (Request) | åç«¯åº”æä¾›çš„ API (Response) | æ¶‰åŠæ•°æ®åº“è¡¨ | çŠ¶æ€ |
|-------------|---------|----------------------|---------------------------|------------|------|
| ä¼šå‘˜ä¸­å¿ƒé¡µ | é¡µé¢åŠ è½½ | `Authorization: Bearer Token` | `GET /api/subscription/status`<br/>è¿”å›: `{ tier, status, expiresAt, features, isPremium }` | `subscriptions`, `profiles` | âœ… å·²å®Œæˆ |
| è´­ä¹°å¼¹çª— | ç‚¹å‡»"ç«‹å³è®¢é˜…" | `{ tier, isYearly, paymentMethod }` | `POST /api/subscription/create`<br/>è¿”å›: `{ success, orderId, payUrl? }` | `subscriptions`, `transactions` | âœ… å·²å®Œæˆ |
| æ”¯ä»˜ç»“æœé¡µ | æ”¯ä»˜å›è°ƒ | `{ orderId }` | `GET /api/subscription/check-status`<br/>è¿”å›: `{ success, tier, status }` | `subscriptions`, `transactions` | âœ… å·²å®Œæˆ |
| å–æ¶ˆè®¢é˜… | ç‚¹å‡»"å–æ¶ˆè®¢é˜…" | `Authorization: Bearer Token` | `POST /api/subscription/cancel`<br/>è¿”å›: `{ success }` | `subscriptions` | âœ… å·²å®Œæˆ |
| æ£€æŸ¥åŠŸèƒ½æƒé™ | ä½¿ç”¨åŠŸèƒ½å‰æ£€æŸ¥ | `{ featurePath }` | `GET /api/subscription/permission/:feature`<br/>è¿”å›: `{ allowed, reason?, upgradeTier? }` | `subscriptions`, `profiles`, `usage_logs` | âœ… å·²å®Œæˆ |
| è·å–ä»Šæ—¥ä½¿ç”¨æ¬¡æ•° | æ˜¾ç¤ºå‰©ä½™æ¬¡æ•° | `{ feature }` | `GET /api/subscription/usage/:feature`<br/>è¿”å›: `{ usage, limit, remaining }` | `usage_logs` | âœ… å·²å®Œæˆ |
| è®°å½•åŠŸèƒ½ä½¿ç”¨ | ä½¿ç”¨åŠŸèƒ½åè®°å½• | `{ feature, metadata? }` | `POST /api/subscription/record-usage`<br/>è¿”å›: `{ success }` | `usage_logs` | âœ… å·²å®Œæˆ |
| æ£€æŸ¥è¿‡æœŸè®¢é˜… | å®šæœŸæ£€æŸ¥ï¼ˆå‰ç«¯è½®è¯¢ï¼‰ | `Authorization: Bearer Token` | `POST /api/subscription/check-expired`<br/>è¿”å›: `{ expired, newTier }` | `subscriptions` | âœ… å·²å®Œæˆ |

**ğŸ“ å‰ç«¯ä»£ç ä½ç½®**ï¼š
- `src/core/services/subscriptionService.ts` - è®¢é˜…æœåŠ¡
- `src/store/userStore.ts` - ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆè®¢é˜…çŠ¶æ€ç›‘å¬ï¼‰
- `src/composables/useMembershipGuard.ts` - ä¼šå‘˜æƒé™å®ˆå«

**âœ… éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… è®¢é˜…çŠ¶æ€æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸ï¼ˆä¼˜å…ˆä» `profiles.tier` è¯»å–ï¼‰
- âœ… åˆ›å»ºè®¢é˜…è®¢å•åŠŸèƒ½æ­£å¸¸
- âœ… æ£€æŸ¥è®¢é˜…çŠ¶æ€åŠŸèƒ½æ­£å¸¸
- âœ… å–æ¶ˆè®¢é˜…åŠŸèƒ½æ­£å¸¸
- âœ… åŠŸèƒ½æƒé™æ£€æŸ¥æ­£å¸¸ï¼ˆæ”¯æŒåµŒå¥—è·¯å¾„ï¼‰
- âœ… ä½¿ç”¨æ¬¡æ•°ç»Ÿè®¡æ­£å¸¸
- âœ… è®°å½•åŠŸèƒ½ä½¿ç”¨æ­£å¸¸
- âœ… è¿‡æœŸè®¢é˜…æ£€æŸ¥æ­£å¸¸

**ğŸ”‘ å…³é”®éœ€æ±‚**ï¼š
1. âœ… **è®¢é˜…çŠ¶æ€æŸ¥è¯¢**ï¼šä¼˜å…ˆä» `profiles.tier` è¯»å–ï¼Œå¦‚æœæ²¡æœ‰å†æŸ¥è¯¢ `subscriptions` è¡¨ - å·²å®ç°
2. âœ… **åŠŸèƒ½æƒé™æ£€æŸ¥**ï¼šæ”¯æŒåµŒå¥—è·¯å¾„ï¼Œå¦‚ `'yijing.available'`, `'ziwei.advancedChart'` - å·²å®ç°
3. âœ… **ä½¿ç”¨æ¬¡æ•°é™åˆ¶**ï¼šæ¯æ—¥ä½¿ç”¨æ¬¡æ•°é™åˆ¶ï¼Œ0è¡¨ç¤ºæ— é™ - å·²å®ç°
4. âœ… **è®¢é˜…è¿‡æœŸæ£€æŸ¥**ï¼šè‡ªåŠ¨æ£€æŸ¥å¹¶æ›´æ–°è¿‡æœŸè®¢é˜…çŠ¶æ€ - å·²å®ç°

---

### æ¨¡å—4ï¼šæ”¯ä»˜ç³»ç»Ÿ (Payment) âœ… **éƒ¨åˆ†å®Œæˆ**

| å‰ç«¯é¡µé¢/åŠŸèƒ½ | ç”¨æˆ·æ“ä½œ | å‰ç«¯éœ€è¦çš„æ•°æ® (Request) | åç«¯åº”æä¾›çš„ API (Response) | æ¶‰åŠæ•°æ®åº“è¡¨ | çŠ¶æ€ |
|-------------|---------|----------------------|---------------------------|------------|------|
| å……å€¼åŒ…åˆ—è¡¨ | é¡µé¢åŠ è½½ | - | `GET /api/payment/packs`<br/>è¿”å›: `CoinPack[]` | - | ğŸš§ å¾…å¼€å‘ |
| åˆ›å»ºæ”¯ä»˜è®¢å• | ç‚¹å‡»"ç«‹å³å……å€¼" | `{ packType?, paymentMethod, customCoins?, customAmount? }` | `POST /api/payment/orders`<br/>è¿”å›: `{ success, orderId, paymentUrl, qrCode }` | `transactions` | âœ… å·²å®Œæˆ |
| æ”¯ä»˜å›è°ƒå¤„ç† | æ”¯ä»˜æˆåŠŸåå›è°ƒ | `{ orderId, paymentResult }` | `POST /api/payment/callback`<br/>è¿”å›: `{ success, coinsGranted }` | `transactions`, `profiles` | âœ… å·²å®Œæˆ |
| æŸ¥è¯¢è®¢å•åˆ—è¡¨ | æŸ¥çœ‹å……å€¼è®°å½• | `Authorization: Bearer Token` | `GET /api/payment/orders`<br/>è¿”å›: `{ orders: Order[] }` | `transactions` | âœ… å·²å®Œæˆ |
| æŸ¥è¯¢è®¢å•è¯¦æƒ… | æŸ¥çœ‹è®¢å•è¯¦æƒ… | `{ orderId }` | `GET /api/payment/orders/:orderId`<br/>è¿”å›: `{ order: Order }` | `transactions` | âœ… å·²å®Œæˆ |
| Mockæ”¯ä»˜æˆåŠŸ | å¼€å‘ç¯å¢ƒæµ‹è¯• | `{ orderId }` | `POST /api/payment/mock/success`<br/>è¿”å›: `{ success }` | `transactions`, `profiles` | âœ… å·²å®Œæˆ |
| è½®è¯¢è®¢å•çŠ¶æ€ | æ”¯ä»˜åè½®è¯¢ | `{ orderId }` | `GET /api/payment/orders/:orderId`<br/>è¿”å›: `{ status, coinsGranted? }` | `transactions` | âœ… å·²å®Œæˆ |

**ğŸ“ å‰ç«¯ä»£ç ä½ç½®**ï¼š
- `src/api/payment.ts` - æ”¯ä»˜APIå°è£…
- `src/services/payment/PaymentService.ts` - æ”¯ä»˜æœåŠ¡
- `src/components/v5/PaymentModal.vue` - æ”¯ä»˜å¼¹çª—ç»„ä»¶

**ğŸ”‘ å…³é”®éœ€æ±‚**ï¼š
1. **å¹‚ç­‰æ€§ä¿æŠ¤**ï¼šæ”¯ä»˜å›è°ƒå¿…é¡»æ”¯æŒå¹‚ç­‰æ€§æ£€æŸ¥ï¼Œé˜²æ­¢é‡å¤å¤„ç†
2. **äº‹åŠ¡ä¿æŠ¤**ï¼šæ”¯ä»˜æˆåŠŸé€»è¾‘ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
3. **è®¢å•çŠ¶æ€**ï¼š`pending` â†’ `paid` â†’ `completed`
4. **è½®è¯¢ç­–ç•¥**ï¼šå‰30ç§’æ¯2ç§’æŸ¥è¯¢ä¸€æ¬¡ï¼Œä¹‹åæ¯5ç§’æŸ¥è¯¢ä¸€æ¬¡ï¼Œæœ€å¤š5åˆ†é’Ÿ

---

### æ¨¡å—5ï¼šå¤©æœºå¸ç³»ç»Ÿ (Coins) âœ… **å·²å®Œæˆ**

| å‰ç«¯é¡µé¢/åŠŸèƒ½ | ç”¨æˆ·æ“ä½œ | å‰ç«¯éœ€è¦çš„æ•°æ® (Request) | åç«¯åº”æä¾›çš„ API (Response) | æ¶‰åŠæ•°æ®åº“è¡¨ | çŠ¶æ€ |
|-------------|---------|----------------------|---------------------------|------------|------|
| æŸ¥è¯¢ä½™é¢ | é¡µé¢åŠ è½½ | `Authorization: Bearer Token` | `GET /api/coins/balance`<br/>è¿”å›: `{ balance, dailyGrant, activityGrant }` | `profiles` | âœ… å·²å®Œæˆ |
| æ‰£è´¹æ“ä½œ | ä½¿ç”¨åŠŸèƒ½æ—¶æ‰£è´¹ | `{ featureType, price }` | `POST /api/coins/deduct`<br/>è¿”å›: `{ success, newBalance, transaction }` | `profiles`, `coin_transactions` | âœ… å·²å®Œæˆ |
| æŸ¥è¯¢äº¤æ˜“æµæ°´ | æŸ¥çœ‹å¤©æœºå¸è®°å½• | `Authorization: Bearer Token` | `GET /api/coins/transactions`<br/>è¿”å›: `{ transactions: Transaction[] }` | `coin_transactions` | âœ… å·²å®Œæˆ |
| ç®¡ç†å‘˜è°ƒæ•´ | ç®¡ç†å‘˜è°ƒæ•´ä½™é¢ | `{ targetUserId, amount, reason, coinType }` | `POST /api/coins/admin/adjust`<br/>è¿”å›: `{ success, newBalance }` | `profiles`, `coin_transactions` | âœ… å·²å®Œæˆ |

**âœ… éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ‰£è´¹åŠŸèƒ½æ­£å¸¸ï¼ˆè°ƒç”¨æ•°æ®åº“å‡½æ•° `deduct_coins`ï¼‰
- âœ… ä½™é¢æŸ¥è¯¢æ­£å¸¸
- âœ… ä½™é¢ä¸è¶³é”™è¯¯å¤„ç†æ­£å¸¸
- âœ… æŸ¥è¯¢äº¤æ˜“æµæ°´æ­£å¸¸

---

### æ¨¡å—6ï¼šç­¾åˆ°ç³»ç»Ÿ (Check-in) âœ… **å·²å®Œæˆ**

| å‰ç«¯é¡µé¢/åŠŸèƒ½ | ç”¨æˆ·æ“ä½œ | å‰ç«¯éœ€è¦çš„æ•°æ® (Request) | åç«¯åº”æä¾›çš„ API (Response) | æ¶‰åŠæ•°æ®åº“è¡¨ | çŠ¶æ€ |
|-------------|---------|----------------------|---------------------------|------------|------|
| æ¯æ—¥ç­¾åˆ° | ç‚¹å‡»"ç­¾åˆ°" | `Authorization: Bearer Token` | `POST /api/checkin/daily`<br/>è¿”å›: `{ success, coinsGranted, consecutiveDays }` | `profiles` | âœ… å·²å®Œæˆ |
| æŸ¥è¯¢ç­¾åˆ°çŠ¶æ€ | é¡µé¢åŠ è½½ | `Authorization: Bearer Token` | `GET /api/checkin/status`<br/>è¿”å›: `{ checkedIn, lastCheckInDate, consecutiveDays }` | `profiles` | âœ… å·²å®Œæˆ |
| æŸ¥è¯¢ç­¾åˆ°è®°å½• | æŸ¥çœ‹å†å²è®°å½• | `Authorization: Bearer Token` | `GET /api/checkin/history`<br/>è¿”å›: `{ records: CheckInRecord[] }` | `profiles` | âœ… å·²å®Œæˆ |

**âœ… éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… æ¯æ—¥ç­¾åˆ°åŠŸèƒ½æ­£å¸¸ï¼ˆè°ƒç”¨æ•°æ®åº“å‡½æ•° `handle_daily_check_in`ï¼‰
- âœ… é‡å¤ç­¾åˆ°é”™è¯¯å¤„ç†æ­£å¸¸
- âœ… è¿ç­¾å¤©æ•°è®¡ç®—æ­£å¸¸

---

### æ¨¡å—7ï¼šç´«å¾®æ–—æ•° (Astrology) âœ… **å·²å®Œæˆ**

| å‰ç«¯é¡µé¢/åŠŸèƒ½ | ç”¨æˆ·æ“ä½œ | å‰ç«¯éœ€è¦çš„æ•°æ® (Request) | åç«¯åº”æä¾›çš„ API (Response) | æ¶‰åŠæ•°æ®åº“è¡¨ | çŠ¶æ€ |
|-------------|---------|----------------------|---------------------------|------------|------|
| ä¿å­˜å‘½ç›˜ | ä¿å­˜å‘½ç›˜ç»“æ„ | `{ chartData }` | `POST /api/astrology/star-chart`<br/>è¿”å›: `{ success, chartId }` | `star_charts` | âœ… å·²å®Œæˆ |
| æŸ¥è¯¢å‘½ç›˜ | åŠ è½½å‘½ç›˜ | `{ chartId? }` | `GET /api/astrology/star-chart`<br/>è¿”å›: `{ chart: StarChart }` | `star_charts` | âœ… å·²å®Œæˆ |
| æ›´æ–°ç®€è¦åˆ†æ | æ›´æ–°ç¼“å­˜ | `{ briefAnalysis }` | `PUT /api/astrology/star-chart/brief-analysis`<br/>è¿”å›: `{ success }` | `star_charts` | âœ… å·²å®Œæˆ |
| è§£é”æ—¶ç©ºèµ„äº§ | è§£é”æ—¶é—´æ®µ | `{ timeRange }` | `POST /api/astrology/time-assets/unlock`<br/>è¿”å›: `{ success, coinsDeducted }` | `unlocked_time_assets`, `profiles` | âœ… å·²å®Œæˆ |
| æŸ¥è¯¢å·²è§£é”èµ„äº§ | æŸ¥çœ‹å·²è§£é” | `Authorization: Bearer Token` | `GET /api/astrology/time-assets`<br/>è¿”å›: `{ assets: TimeAsset[] }` | `unlocked_time_assets` | âœ… å·²å®Œæˆ |
| æ£€æŸ¥æ˜¯å¦å·²è§£é” | ä½¿ç”¨å‰æ£€æŸ¥ | `{ timeRange }` | `GET /api/astrology/time-assets/check`<br/>è¿”å›: `{ unlocked, asset? }` | `unlocked_time_assets` | âœ… å·²å®Œæˆ |
| ä¿å­˜ç¼“å­˜ | ä¿å­˜æ—¶ç©ºç¼“å­˜ | `{ cacheData }` | `POST /api/astrology/cache`<br/>è¿”å›: `{ success }` | `timespace_cache` | âœ… å·²å®Œæˆ |
| æŸ¥è¯¢ç¼“å­˜ | åŠ è½½ç¼“å­˜ | `{ cacheKey }` | `GET /api/astrology/cache`<br/>è¿”å›: `{ cache: CacheData }` | `timespace_cache` | âœ… å·²å®Œæˆ |

**âœ… éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… å‘½ç›˜å­˜æ¡£åŠŸèƒ½æ­£å¸¸
- âœ… æ—¶ç©ºèµ„äº§è§£é”åŠŸèƒ½æ­£å¸¸ï¼ˆéœ€è¦æ‰£è´¹ï¼‰
- âœ… ç¼“å­˜æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸

---

### æ¨¡å—8ï¼šç®¡ç†å‘˜åå° (Admin) âœ… **å·²å®Œæˆ**

| å‰ç«¯é¡µé¢/åŠŸèƒ½ | ç”¨æˆ·æ“ä½œ | å‰ç«¯éœ€è¦çš„æ•°æ® (Request) | åç«¯åº”æä¾›çš„ API (Response) | æ¶‰åŠæ•°æ®åº“è¡¨ | çŠ¶æ€ |
|-------------|---------|----------------------|---------------------------|------------|------|
| ç”¨æˆ·ç®¡ç†é¡µ | é¡µé¢åŠ è½½ | `Authorization: Bearer Token`<br/>`{ page, pageSize, search?, role?, tier?, sortBy?, sortOrder? }` | `GET /api/admin/users`<br/>è¿”å›: `{ success, data: User[], pagination }` | `profiles` | âœ… å·²å®Œæˆ |
| ç”¨æˆ·è¯¦æƒ… | æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ… | `{ userId }` | `GET /api/admin/users/:userId`<br/>è¿”å›: `{ success, data: UserDetail }` | `profiles` | âœ… å·²å®Œæˆ |
| ä¿®æ”¹ç”¨æˆ·ç­‰çº§ | ä¿®æ”¹ç”¨æˆ·tier | `{ userId, tier }` | `PUT /api/admin/users/:userId/tier`<br/>è¿”å›: `{ success, message }` | `profiles` | âœ… å·²å®Œæˆ |
| è°ƒæ•´ç”¨æˆ·å¤©æœºå¸ | è°ƒæ•´ç”¨æˆ·å¤©æœºå¸ | `{ userId, adjustmentAmount, reason?, coinType? }` | `PUT /api/admin/users/:userId/coins`<br/>è¿”å›: `{ success, message, data: { new_balance } }` | `profiles`, `transactions` | âœ… å·²å®Œæˆ |
| å¤©æœºå¸æµæ°´ | æŸ¥çœ‹å¤©æœºå¸è®°å½• | `{ page, pageSize, userId?, startDate?, endDate?, type?, status? }` | `GET /api/admin/coin-transactions`<br/>è¿”å›: `{ success, data: Transaction[], pagination }` | `transactions` | âœ… å·²å®Œæˆ |
| èµ„é‡‘æµæ°´ | æŸ¥çœ‹æ”¯ä»˜è®°å½• | `{ page, pageSize, userId?, startDate?, endDate?, type?, status? }` | `GET /api/admin/payment-transactions`<br/>è¿”å›: `{ success, data: Transaction[], pagination }` | `transactions` | âœ… å·²å®Œæˆ |
| æ•°æ®æ¦‚è§ˆç»Ÿè®¡ | æŸ¥çœ‹æ•°æ®æ¦‚è§ˆ | `Authorization: Bearer Token` | `GET /api/admin/stats/overview`<br/>è¿”å›: `{ success, data: OverviewStats }` | `profiles`, `transactions` | âœ… å·²å®Œæˆ |
| ç”¨æˆ·ç»Ÿè®¡ | æŸ¥çœ‹ç”¨æˆ·ç»Ÿè®¡ | `{ days? }` | `GET /api/admin/stats/users`<br/>è¿”å›: `{ success, data: UserStats }` | `profiles` | âœ… å·²å®Œæˆ |
| æ”¶å…¥ç»Ÿè®¡ | æŸ¥çœ‹æ”¶å…¥ç»Ÿè®¡ | `{ days? }` | `GET /api/admin/stats/revenue`<br/>è¿”å›: `{ success, data: RevenueStats }` | `transactions` | âœ… å·²å®Œæˆ |
| å•†å“ç®¡ç† | æŸ¥çœ‹å……å€¼åŒ… | `Authorization: Bearer Token` | `GET /api/admin/products`<br/>è¿”å›: `{ products: Product[] }` | - | ğŸš§ å¾…å¼€å‘ |

**ğŸ“ å‰ç«¯ä»£ç ä½ç½®**ï¼š
- `src/views/admin/UserManagement.vue` - ç”¨æˆ·ç®¡ç†
- `src/views/admin/CoinTransactionLogs.vue` - å¤©æœºå¸æµæ°´
- `src/views/admin/PaymentTransactionLogs.vue` - èµ„é‡‘æµæ°´

**âœ… éªŒæ”¶æ ‡å‡†**ï¼š
- âœ… ç”¨æˆ·ç®¡ç†åŠŸèƒ½æ­£å¸¸ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€ä¿®æ”¹ç­‰çº§ã€è°ƒæ•´å¤©æœºå¸ï¼‰
- âœ… äº¤æ˜“æµæ°´æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸ï¼ˆå¤©æœºå¸æµæ°´ã€æ”¯ä»˜æµæ°´ï¼‰
- âœ… æ•°æ®ç»Ÿè®¡åŠŸèƒ½æ­£å¸¸ï¼ˆæ¦‚è§ˆã€ç”¨æˆ·ç»Ÿè®¡ã€æ”¶å…¥ç»Ÿè®¡ï¼‰
- âœ… æƒé™éªŒè¯æ­£å¸¸ï¼ˆæ‰€æœ‰APIéƒ½éœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
- âœ… åˆ†é¡µã€æœç´¢ã€ç­›é€‰åŠŸèƒ½æ­£å¸¸

**ğŸ”‘ å…³é”®éœ€æ±‚**ï¼š
1. **æƒé™æ£€æŸ¥**ï¼šæ‰€æœ‰ç®¡ç†å‘˜APIéœ€è¦æ£€æŸ¥ç®¡ç†å‘˜æƒé™ï¼ˆè°ƒç”¨ `is_admin()` å‡½æ•°ï¼‰âœ… å·²å®ç°
2. **åˆ†é¡µæŸ¥è¯¢**ï¼šæ”¯æŒåˆ†é¡µã€æœç´¢ã€ç­›é€‰ã€æ’åº âœ… å·²å®ç°
3. **æ•°æ®ç»Ÿè®¡**ï¼šè¿”å›æ€»æ•°ã€åˆ†é¡µä¿¡æ¯ã€ç»Ÿè®¡æ•°æ® âœ… å·²å®ç°

---

### æ¨¡å—9ï¼šå…¶ä»–ä¸šåŠ¡åŠŸèƒ½ ğŸš§ **å¾…æ¢³ç†**

#### 9.1 å åœå†å² (Divination History)

| å‰ç«¯é¡µé¢/åŠŸèƒ½ | ç”¨æˆ·æ“ä½œ | å‰ç«¯éœ€è¦çš„æ•°æ® (Request) | åç«¯åº”æä¾›çš„ API (Response) | æ¶‰åŠæ•°æ®åº“è¡¨ | çŠ¶æ€ |
|-------------|---------|----------------------|---------------------------|------------|------|
| æŸ¥è¯¢å åœå†å² | é¡µé¢åŠ è½½ | `Authorization: Bearer Token`<br/>`{ page?, pageSize?, type? }` | `GET /api/divination/history`<br/>è¿”å›: `{ records: DivinationRecord[], total }` | `divination_history` | ğŸš§ å¾…å¼€å‘ |
| ä¿å­˜å åœè®°å½• | å®Œæˆå åœåä¿å­˜ | `{ type, data, result }` | `POST /api/divination/history`<br/>è¿”å›: `{ success, recordId }` | `divination_history` | ğŸš§ å¾…å¼€å‘ |
| åˆ é™¤å åœè®°å½• | åˆ é™¤è®°å½• | `{ recordId }` | `DELETE /api/divination/history/:recordId`<br/>è¿”å›: `{ success }` | `divination_history` | ğŸš§ å¾…å¼€å‘ |

#### 9.2 å‘½ç›˜å­˜æ¡£ (Chart Archives)

| å‰ç«¯é¡µé¢/åŠŸèƒ½ | ç”¨æˆ·æ“ä½œ | å‰ç«¯éœ€è¦çš„æ•°æ® (Request) | åç«¯åº”æä¾›çš„ API (Response) | æ¶‰åŠæ•°æ®åº“è¡¨ | çŠ¶æ€ |
|-------------|---------|----------------------|---------------------------|------------|------|
| æŸ¥è¯¢å‘½ç›˜å­˜æ¡£ | é¡µé¢åŠ è½½ | `Authorization: Bearer Token` | `GET /api/astrology/archives`<br/>è¿”å›: `{ archives: ChartArchive[] }` | `ziwei_chart_archives` | ğŸš§ å¾…å¼€å‘ |
| ä¿å­˜å‘½ç›˜å­˜æ¡£ | ä¿å­˜å‘½ç›˜ | `{ chartData, name, description? }` | `POST /api/astrology/archives`<br/>è¿”å›: `{ success, archiveId }` | `ziwei_chart_archives` | ğŸš§ å¾…å¼€å‘ |
| åˆ é™¤å‘½ç›˜å­˜æ¡£ | åˆ é™¤å­˜æ¡£ | `{ archiveId }` | `DELETE /api/astrology/archives/:archiveId`<br/>è¿”å›: `{ success }` | `ziwei_chart_archives` | ğŸš§ å¾…å¼€å‘ |

#### 9.3 ç”¨æˆ·æ¡£æ¡ˆå­˜æ¡£ (Profile Archives)

| å‰ç«¯é¡µé¢/åŠŸèƒ½ | ç”¨æˆ·æ“ä½œ | å‰ç«¯éœ€è¦çš„æ•°æ® (Request) | åç«¯åº”æä¾›çš„ API (Response) | æ¶‰åŠæ•°æ®åº“è¡¨ | çŠ¶æ€ |
|-------------|---------|----------------------|---------------------------|------------|------|
| æŸ¥è¯¢æ¡£æ¡ˆå­˜æ¡£ | é¡µé¢åŠ è½½ | `Authorization: Bearer Token` | `GET /api/user/archives`<br/>è¿”å›: `{ archives: ProfileArchive[] }` | `profiles_archives` | ğŸš§ å¾…å¼€å‘ |
| ä¿å­˜æ¡£æ¡ˆå­˜æ¡£ | ä¿å­˜æ¡£æ¡ˆ | `{ archiveData, name }` | `POST /api/user/archives`<br/>è¿”å›: `{ success, archiveId }` | `profiles_archives` | ğŸš§ å¾…å¼€å‘ |

---

## ğŸš€ ç¬¬äºŒæ­¥ï¼šå®Œå–„åç«¯å¼€å‘æ–¹æ¡ˆï¼ˆAPI æ–‡æ¡£åŒ–ï¼‰

### ä¼˜å…ˆçº§æ’åºï¼ˆP0 â†’ P3ï¼‰

#### âœ… P0 ä¼˜å…ˆçº§ï¼šæ ¸å¿ƒä¸šåŠ¡ï¼ˆå·²éƒ¨åˆ†å®Œæˆï¼‰

1. **è®¤è¯æ¨¡å— (Auth)** âœ… **å·²å®Œæˆ**
   - âœ… `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
   - âœ… `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
   - âœ… `GET /api/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

2. **ç”¨æˆ·èµ„æ–™æ¨¡å— (User)** âœ… **å·²å®Œæˆ**
   - âœ… `GET /api/user/profile` - è·å–ç”¨æˆ·èµ„æ–™
   - âœ… `PUT /api/user/profile` - æ›´æ–°ç”¨æˆ·èµ„æ–™
   - âœ… `GET /api/user/tier` - è·å–ç”¨æˆ·ç­‰çº§

3. **å¤©æœºå¸ç³»ç»Ÿ (Coins)** âœ… **å·²å®Œæˆ**
   - âœ… `GET /api/coins/balance` - æŸ¥è¯¢ä½™é¢
   - âœ… `POST /api/coins/deduct` - æ‰£è´¹
   - âœ… `GET /api/coins/transactions` - æŸ¥è¯¢äº¤æ˜“æµæ°´
   - âœ… `POST /api/coins/admin/adjust` - ç®¡ç†å‘˜è°ƒæ•´

4. **ç­¾åˆ°ç³»ç»Ÿ (Check-in)** âœ… **å·²å®Œæˆ**
   - âœ… `POST /api/checkin/daily` - æ¯æ—¥ç­¾åˆ°
   - âœ… `GET /api/checkin/status` - æŸ¥è¯¢ç­¾åˆ°çŠ¶æ€
   - âœ… `GET /api/checkin/history` - æŸ¥è¯¢ç­¾åˆ°è®°å½•

5. **æ”¯ä»˜ç³»ç»Ÿ (Payment)** âœ… **éƒ¨åˆ†å®Œæˆ**
   - âœ… `POST /api/payment/orders` - åˆ›å»ºæ”¯ä»˜è®¢å•
   - âœ… `POST /api/payment/callback` - æ”¯ä»˜å›è°ƒå¤„ç†
   - âœ… `GET /api/payment/orders` - æŸ¥è¯¢è®¢å•åˆ—è¡¨
   - âœ… `GET /api/payment/orders/:orderId` - æŸ¥è¯¢è®¢å•è¯¦æƒ…
   - âœ… `POST /api/payment/mock/success` - Mockæ”¯ä»˜æˆåŠŸï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
   - ğŸš§ `GET /api/payment/packs` - è·å–å……å€¼åŒ…åˆ—è¡¨ï¼ˆå¾…å¼€å‘ï¼‰

6. **ç´«å¾®æ–—æ•° (Astrology)** âœ… **å·²å®Œæˆ**
   - âœ… `POST /api/astrology/star-chart` - ä¿å­˜å‘½ç›˜
   - âœ… `GET /api/astrology/star-chart` - æŸ¥è¯¢å‘½ç›˜
   - âœ… `PUT /api/astrology/star-chart/brief-analysis` - æ›´æ–°ç®€è¦åˆ†æ
   - âœ… `POST /api/astrology/time-assets/unlock` - è§£é”æ—¶ç©ºèµ„äº§
   - âœ… `GET /api/astrology/time-assets` - æŸ¥è¯¢å·²è§£é”èµ„äº§
   - âœ… `GET /api/astrology/time-assets/check` - æ£€æŸ¥æ˜¯å¦å·²è§£é”
   - âœ… `POST /api/astrology/cache` - ä¿å­˜ç¼“å­˜
   - âœ… `GET /api/astrology/cache` - æŸ¥è¯¢ç¼“å­˜

---

#### âœ… P1 ä¼˜å…ˆçº§ï¼šè®¢é˜…/ä¼šå‘˜ç³»ç»Ÿï¼ˆé‡æ„é‡ç‚¹ï¼‰âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šå®ç°å®Œæ•´çš„è®¢é˜…/ä¼šå‘˜ç³»ç»Ÿï¼Œæ”¯æŒå››çº§ä¼šå‘˜ä½“ç³»ï¼ˆå…è´¹ã€åŸºç¡€ã€é«˜çº§ã€VIPï¼‰

**API åˆ—è¡¨**ï¼š

1. **è®¢é˜…çŠ¶æ€æŸ¥è¯¢** âœ… **å·²å®Œæˆ**
   - âœ… `GET /api/subscription/status`
   - åŠŸèƒ½ï¼šè·å–ç”¨æˆ·å½“å‰è®¢é˜…çŠ¶æ€ã€ç­‰çº§ã€åŠŸèƒ½æƒé™
   - è¿”å›ï¼š`{ tier, status, expiresAt, features, isPremium }`
   - æ•°æ®åº“ï¼šä¼˜å…ˆä» `profiles.tier` è¯»å–ï¼Œå¦‚æœæ²¡æœ‰å†æŸ¥è¯¢ `subscriptions` è¡¨

2. **åˆ›å»ºè®¢é˜…** âœ… **å·²å®Œæˆ**
   - âœ… `POST /api/subscription/create`
   - åŠŸèƒ½ï¼šåˆ›å»ºè®¢é˜…è®¢å•ï¼ˆéœ€è¦å…ˆåˆ›å»ºæ”¯ä»˜è®¢å•ï¼‰
   - è¯·æ±‚ï¼š`{ tier, isYearly, paymentMethod }`
   - è¿”å›ï¼š`{ success, orderId, payUrl? }`
   - æ•°æ®åº“ï¼š`subscriptions`, `transactions`

3. **æ£€æŸ¥è®¢é˜…çŠ¶æ€** âœ… **å·²å®Œæˆ**
   - âœ… `GET /api/subscription/check-status`
   - åŠŸèƒ½ï¼šæ”¯ä»˜å›è°ƒåæ£€æŸ¥è®¢é˜…çŠ¶æ€
   - è¯·æ±‚ï¼š`{ orderId }`
   - è¿”å›ï¼š`{ success, tier, status }`

4. **å–æ¶ˆè®¢é˜…** âœ… **å·²å®Œæˆ**
   - âœ… `POST /api/subscription/cancel`
   - åŠŸèƒ½ï¼šå–æ¶ˆå½“å‰è®¢é˜…ï¼ˆä¸ç«‹å³ç”Ÿæ•ˆï¼Œåˆ°æœŸåä¸å†ç»­è´¹ï¼‰
   - è¿”å›ï¼š`{ success }`

5. **æ£€æŸ¥åŠŸèƒ½æƒé™** âœ… **å·²å®Œæˆ**
   - âœ… `GET /api/subscription/permission/:feature`
   - åŠŸèƒ½ï¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒé™ä½¿ç”¨æŸä¸ªåŠŸèƒ½
   - è¯·æ±‚ï¼š`{ featurePath }`ï¼ˆæ”¯æŒåµŒå¥—è·¯å¾„ï¼Œå¦‚ `'yijing.available'`ï¼‰
   - è¿”å›ï¼š`{ allowed, reason?, upgradeTier? }`

6. **è·å–ä»Šæ—¥ä½¿ç”¨æ¬¡æ•°** âœ… **å·²å®Œæˆ**
   - âœ… `GET /api/subscription/usage/:feature`
   - åŠŸèƒ½ï¼šè·å–ç”¨æˆ·ä»Šæ—¥ä½¿ç”¨æŸä¸ªåŠŸèƒ½çš„æ¬¡æ•°
   - è¿”å›ï¼š`{ usage, limit, remaining }`

7. **è®°å½•åŠŸèƒ½ä½¿ç”¨** âœ… **å·²å®Œæˆ**
   - âœ… `POST /api/subscription/record-usage`
   - åŠŸèƒ½ï¼šè®°å½•åŠŸèƒ½ä½¿ç”¨ï¼ˆç”¨äºç»Ÿè®¡å’Œé™åˆ¶ï¼‰
   - è¯·æ±‚ï¼š`{ feature, metadata? }`
   - è¿”å›ï¼š`{ success }`

8. **æ£€æŸ¥è¿‡æœŸè®¢é˜…** âœ… **å·²å®Œæˆ**
   - âœ… `POST /api/subscription/check-expired`
   - åŠŸèƒ½ï¼šæ£€æŸ¥å¹¶æ›´æ–°è¿‡æœŸè®¢é˜…çŠ¶æ€
   - è¿”å›ï¼š`{ expired, newTier }`

**âœ… æµ‹è¯•çŠ¶æ€**ï¼š
- âœ… æµ‹è¯•éªŒè¯ï¼ˆ12/12 æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼Œ100%ï¼‰
- âœ… æµ‹è¯•ç»“æœæŠ¥å‘Šï¼ˆ`SUBSCRIPTION_ISSUE_REPORT.md`ï¼‰

**ğŸ“ å‰ç«¯ä»£ç å‚è€ƒ**ï¼š
- `src/core/services/subscriptionService.ts` - è®¢é˜…æœåŠ¡ï¼ˆ1106è¡Œï¼‰
- `src/store/userStore.ts` - ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆè®¢é˜…çŠ¶æ€ç›‘å¬ï¼‰
- `src/composables/useMembershipGuard.ts` - ä¼šå‘˜æƒé™å®ˆå«

**ğŸ”‘ å…³é”®éœ€æ±‚**ï¼š
1. âœ… **å››çº§ä¼šå‘˜ä½“ç³»**ï¼š`free`ï¼ˆæ¢ç´¢è€…ï¼‰ã€`basic`ï¼ˆå¼€æ‚Ÿè€…ï¼‰ã€`premium`ï¼ˆå¤©å‘½å¸ˆï¼‰ã€`vip`ï¼ˆç„æœºå¤§å¸ˆï¼‰- å·²å®ç°
2. âœ… **åŠŸèƒ½æƒé™é…ç½®**ï¼šæ¯ä¸ªç­‰çº§æœ‰ä¸åŒçš„åŠŸèƒ½æƒé™é…ç½®ï¼ˆè§ `subscriptionService.ts` ä¸­çš„ `PLANS` é…ç½®ï¼‰- å·²å®ç°
3. âœ… **ä½¿ç”¨æ¬¡æ•°é™åˆ¶**ï¼šæ”¯æŒæ¯æ—¥ä½¿ç”¨æ¬¡æ•°é™åˆ¶ï¼Œ0è¡¨ç¤ºæ— é™ - å·²å®ç°
4. âœ… **è®¢é˜…è¿‡æœŸæ£€æŸ¥**ï¼šè‡ªåŠ¨æ£€æŸ¥å¹¶æ›´æ–°è¿‡æœŸè®¢é˜…çŠ¶æ€ - å·²å®ç°

---

#### âœ… P2 ä¼˜å…ˆçº§ï¼šç®¡ç†å‘˜åå°ï¼ˆæ•°æ®å¤§ç›˜ï¼‰âœ… **å·²å®Œæˆ**

**ç›®æ ‡**ï¼šå®ç°ç®¡ç†å‘˜åå°APIï¼Œæ”¯æŒç”¨æˆ·ç®¡ç†ã€æ•°æ®æŸ¥è¯¢ã€ç»Ÿè®¡åˆ†æ

**API åˆ—è¡¨**ï¼š

1. **ç”¨æˆ·ç®¡ç†** âœ… **å·²å®Œæˆ**
   - âœ… `GET /api/admin/users` - ç”¨æˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µã€æœç´¢ã€ç­›é€‰ã€æ’åºï¼‰
   - âœ… `GET /api/admin/users/:userId` - ç”¨æˆ·è¯¦æƒ…
   - âœ… `PUT /api/admin/users/:userId/tier` - ä¿®æ”¹ç”¨æˆ·ç­‰çº§
   - âœ… `PUT /api/admin/users/:userId/coins` - è°ƒæ•´ç”¨æˆ·å¤©æœºå¸

2. **äº¤æ˜“æµæ°´æŸ¥è¯¢** âœ… **å·²å®Œæˆ**
   - âœ… `GET /api/admin/coin-transactions` - å¤©æœºå¸æµæ°´ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰
   - âœ… `GET /api/admin/payment-transactions` - èµ„é‡‘æµæ°´ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰

3. **æ•°æ®ç»Ÿè®¡** âœ… **å·²å®Œæˆ**
   - âœ… `GET /api/admin/stats/overview` - æ•°æ®æ¦‚è§ˆ
   - âœ… `GET /api/admin/stats/users` - ç”¨æˆ·ç»Ÿè®¡
   - âœ… `GET /api/admin/stats/revenue` - æ”¶å…¥ç»Ÿè®¡

**âœ… æµ‹è¯•çŠ¶æ€**ï¼š
- âœ… æµ‹è¯•æ–‡æ¡£å·²åˆ›å»ºï¼ˆ`TEST_ADMIN.md`ï¼‰
- â³ 18ä¸ªæµ‹è¯•ç”¨ä¾‹å¾…éªŒè¯

**ğŸ”‘ å…³é”®éœ€æ±‚**ï¼š
1. âœ… **æƒé™æ£€æŸ¥**ï¼šæ‰€æœ‰ç®¡ç†å‘˜APIéœ€è¦æ£€æŸ¥ç®¡ç†å‘˜æƒé™ï¼ˆè°ƒç”¨ `is_admin()` å‡½æ•°ï¼‰- å·²å®ç°
2. âœ… **åˆ†é¡µæŸ¥è¯¢**ï¼šæ”¯æŒåˆ†é¡µã€æœç´¢ã€ç­›é€‰ã€æ’åº - å·²å®ç°
3. âœ… **æ•°æ®ç»Ÿè®¡**ï¼šè¿”å›æ€»æ•°ã€åˆ†é¡µä¿¡æ¯ã€ç»Ÿè®¡æ•°æ® - å·²å®ç°

---

#### ğŸš§ P3 ä¼˜å…ˆçº§ï¼šå…¶ä»–ä¸šåŠ¡åŠŸèƒ½ï¼ˆæŒ‰éœ€å¼€å‘ï¼‰

1. **å åœå†å² (Divination History)**
   - `GET /api/divination/history` - æŸ¥è¯¢å åœå†å²
   - `POST /api/divination/history` - ä¿å­˜å åœè®°å½•
   - `DELETE /api/divination/history/:recordId` - åˆ é™¤å åœè®°å½•

2. **å‘½ç›˜å­˜æ¡£ (Chart Archives)**
   - `GET /api/astrology/archives` - æŸ¥è¯¢å‘½ç›˜å­˜æ¡£
   - `POST /api/astrology/archives` - ä¿å­˜å‘½ç›˜å­˜æ¡£
   - `DELETE /api/astrology/archives/:archiveId` - åˆ é™¤å‘½ç›˜å­˜æ¡£

3. **ç”¨æˆ·æ¡£æ¡ˆå­˜æ¡£ (Profile Archives)**
   - `GET /api/user/archives` - æŸ¥è¯¢æ¡£æ¡ˆå­˜æ¡£
   - `POST /api/user/archives` - ä¿å­˜æ¡£æ¡ˆå­˜æ¡£

---

## ğŸš€ ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œç­–ç•¥ï¼ˆåˆ†è€Œæ²»ä¹‹ï¼‰

### æ¨èå¼€å‘èŠ‚å¥

**åƒä¸‡ä¸è¦è¯•å›¾ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰æ–¹æ¡ˆéƒ½å†™å®Œç¾äº†å†åŠ¨ä»£ç ã€‚é‚£æ ·ä½ ä¼šé™·å…¥"åˆ†æç˜«ç—ª"ã€‚**

æ¨èçš„èŠ‚å¥ï¼š
1. **æ¢³ç†ä¸€ä¸ªæ¨¡å—**ï¼ˆæ¯”å¦‚ï¼šè®¢é˜…æ¨¡å—ï¼‰
2. **å†™è¯¥æ¨¡å—çš„åç«¯ä»£ç **ï¼ˆController, Service, Routeï¼‰
3. **ç”¨ Postman æµ‹è¯•é€š**ï¼ˆç¡®ä¿åç«¯é€»è¾‘æ˜¯å¯¹çš„ï¼‰
4. **å»æœ¬åœ°å‰ç«¯é¡¹ç›®ä¿®æ”¹ä»£ç **ï¼ˆæŠŠ Supabase SDK æ›¿æ¢æˆ axios.postï¼‰
5. **è”è°ƒæˆåŠŸï¼ŒCommit Git**
6. **å¼€å§‹ä¸‹ä¸€ä¸ªæ¨¡å—**

### å½“å‰è¿›åº¦æ€»ç»“

**âœ… å·²å®Œæˆï¼ˆ6ä¸ªæ¨¡å—ï¼Œ49ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ100%é€šè¿‡ç‡ï¼‰**ï¼š
- âœ… è®¤è¯ç³»ç»Ÿï¼ˆ9/9æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… ç”¨æˆ·èµ„æ–™APIï¼ˆ6/6æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… å¤©æœºå¸ç³»ç»Ÿï¼ˆ7/7æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… ç­¾åˆ°ç³»ç»Ÿï¼ˆ7/7æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… æ”¯ä»˜ç³»ç»Ÿï¼ˆ8/8æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… ç´«å¾®æ–—æ•°ï¼ˆ12/12æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰

**âœ… å·²å®Œæˆï¼ˆ7ä¸ªæ¨¡å—ï¼Œ67ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ100%é€šè¿‡ç‡ï¼‰**ï¼š
- âœ… è®¤è¯ç³»ç»Ÿï¼ˆ9/9æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… ç”¨æˆ·èµ„æ–™APIï¼ˆ6/6æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… å¤©æœºå¸ç³»ç»Ÿï¼ˆ7/7æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… ç­¾åˆ°ç³»ç»Ÿï¼ˆ7/7æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… æ”¯ä»˜ç³»ç»Ÿï¼ˆ8/8æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… ç´«å¾®æ–—æ•°ï¼ˆ12/12æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… è®¢é˜…/ä¼šå‘˜ç³»ç»Ÿï¼ˆ12/12æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼‰
- âœ… ç®¡ç†å‘˜åå°ï¼ˆ9ä¸ªAPIï¼Œ18ä¸ªæµ‹è¯•ç”¨ä¾‹å¾…éªŒè¯ï¼‰

**ğŸš§ å¾…å¼€å‘ï¼ˆä¼˜å…ˆçº§æ’åºï¼‰**ï¼š
- ğŸš§ **P3ï¼šå…¶ä»–ä¸šåŠ¡åŠŸèƒ½**ï¼ˆæŒ‰éœ€å¼€å‘ï¼‰
  - ğŸš§ å•†å“ç®¡ç†ï¼ˆ`GET /api/admin/products`ï¼‰
  - ğŸš§ å åœå†å²ï¼ˆ3ä¸ªAPIï¼‰
  - ğŸš§ å‘½ç›˜å­˜æ¡£ï¼ˆ3ä¸ªAPIï¼‰
  - ğŸš§ ç”¨æˆ·æ¡£æ¡ˆå­˜æ¡£ï¼ˆ2ä¸ªAPIï¼‰

---

## ğŸ“ å¼€å‘æ³¨æ„äº‹é¡¹

### 1. æ•°æ®åº“å‡½æ•°è°ƒç”¨

- âœ… **ä¼˜å…ˆä½¿ç”¨æ˜¾å¼å‚æ•°**ï¼šå¦‚æœå·²æ‰§è¡Œ `migration-refactor-auth-uid-to-explicit-params.sql`ï¼Œä½¿ç”¨æ˜¾å¼å‚æ•°è°ƒç”¨å‡½æ•°
- âš ï¸ **ä¼šè¯å˜é‡æ–¹å¼**ï¼šå¦‚æœæœªæ‰§è¡Œé‡æ„è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ä¼šè¯å˜é‡æ–¹å¼ï¼ˆä¸æ¨èï¼‰

### 2. äº‹åŠ¡å¤„ç†

- âœ… **ç”¨æˆ·æ³¨å†Œ**ï¼šå¿…é¡»åœ¨äº‹åŠ¡ä¸­åŒæ—¶åˆ›å»º `auth.users` å’Œ `profiles`
- âœ… **æ”¯ä»˜å¤„ç†**ï¼šå¿…é¡»åœ¨äº‹åŠ¡ä¸­å¤„ç†è®¢å•å’Œä½™é¢æ›´æ–°
- âœ… **æ‰£è´¹æ“ä½œ**ï¼šä½¿ç”¨æ•°æ®åº“å‡½æ•° `deduct_coins`ï¼Œå·²åŒ…å«äº‹åŠ¡å’Œé”æœºåˆ¶

### 3. é”™è¯¯å¤„ç†

- âœ… ä½¿ç”¨ PostgreSQL é”™è¯¯ç è¿›è¡Œé”™è¯¯åˆ†ç±»
- âœ… è¿”å›å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- âœ… è®°å½•é”™è¯¯æ—¥å¿—

### 4. å®‰å…¨æ€§

- âœ… æ‰€æœ‰ API ä½¿ç”¨ JWT Token è®¤è¯
- âœ… ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢ SQL æ³¨å…¥
- âœ… å¯†ç ä½¿ç”¨ bcrypt åŠ å¯†ï¼ˆå…¼å®¹ Supabase æ ¼å¼ï¼‰
- âœ… ä½¿ç”¨ Helmet è®¾ç½®å®‰å…¨å¤´
- âœ… ä½¿ç”¨é™æµä¸­é—´ä»¶é˜²æ­¢æš´åŠ›æ”»å‡»

### 5. è®¢é˜…ç³»ç»Ÿç‰¹æ®Šè¦æ±‚

- âœ… **ä¼˜å…ˆçº§è¯»å–**ï¼šä¼˜å…ˆä» `profiles.tier` è¯»å–ï¼Œå¦‚æœæ²¡æœ‰å†æŸ¥è¯¢ `subscriptions` è¡¨
- âœ… **åŠŸèƒ½æƒé™é…ç½®**ï¼šæ¯ä¸ªç­‰çº§æœ‰ä¸åŒçš„åŠŸèƒ½æƒé™é…ç½®ï¼ˆè§å‰ç«¯ `subscriptionService.ts`ï¼‰
- âœ… **ä½¿ç”¨æ¬¡æ•°é™åˆ¶**ï¼šæ”¯æŒæ¯æ—¥ä½¿ç”¨æ¬¡æ•°é™åˆ¶ï¼Œ0è¡¨ç¤ºæ— é™
- âœ… **è®¢é˜…è¿‡æœŸæ£€æŸ¥**ï¼šè‡ªåŠ¨æ£€æŸ¥å¹¶æ›´æ–°è¿‡æœŸè®¢é˜…çŠ¶æ€

---

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

### API å®Œæˆåº¦ç»Ÿè®¡

| æ¨¡å— | æ€»APIæ•° | å·²å®Œæˆ | å¾…å¼€å‘ | å®Œæˆåº¦ |
|------|---------|--------|--------|--------|
| è®¤è¯ç³»ç»Ÿ | 3 | 3 | 0 | 100% |
| ç”¨æˆ·èµ„æ–™ | 3 | 3 | 0 | 100% |
| å¤©æœºå¸ç³»ç»Ÿ | 4 | 4 | 0 | 100% |
| ç­¾åˆ°ç³»ç»Ÿ | 3 | 3 | 0 | 100% |
| æ”¯ä»˜ç³»ç»Ÿ | 7 | 6 | 1 | 86% |
| ç´«å¾®æ–—æ•° | 8 | 8 | 0 | 100% |
| è®¢é˜…/ä¼šå‘˜ç³»ç»Ÿ | 8 | 8 | 0 | 100% |
| ç®¡ç†å‘˜åå° | 10 | 9 | 1 | 90% |
| å…¶ä»–ä¸šåŠ¡åŠŸèƒ½ | 6 | 0 | 6 | 0% |
| **æ€»è®¡** | **52** | **44** | **8** | **85%** |

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹ï¼šè®¢é˜…/ä¼šå‘˜ç³»ç»Ÿï¼ˆP1ä¼˜å…ˆçº§ï¼‰

**ç¬¬ä¸€æ­¥ï¼šæ¢³ç†è®¢é˜…ç³»ç»ŸAPIéœ€æ±‚**
- [x] å·²å®Œæˆï¼šå‰ç«¯ä»£ç åˆ†æï¼ˆ`subscriptionService.ts`ï¼‰
- [x] å·²å®Œæˆï¼šAPIéœ€æ±‚æ˜ å°„ï¼ˆè§ä¸Šæ–¹è¡¨æ ¼ï¼‰
- [ ] å¾…å®Œæˆï¼šè¯¦ç»†APIè®¾è®¡æ–‡æ¡£

**ç¬¬äºŒæ­¥ï¼šå¼€å‘è®¢é˜…ç³»ç»Ÿåç«¯**
- [ ] åˆ›å»º `src/services/subscription.service.ts`
- [ ] åˆ›å»º `src/routes/subscription.routes.ts`
- [ ] åˆ›å»º `src/controllers/subscription.controller.ts`
- [ ] é›†æˆè®¤è¯ä¸­é—´ä»¶

**ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•éªŒè¯**
- [ ] ä½¿ç”¨ Postman æµ‹è¯•æ‰€æœ‰API
- [ ] ç¡®ä¿åç«¯é€»è¾‘æ­£ç¡®

**ç¬¬å››æ­¥ï¼šå‰ç«¯é€‚é…**
- [ ] ä¿®æ”¹å‰ç«¯ä»£ç ï¼ˆæŠŠ Supabase SDK æ›¿æ¢æˆ axios.postï¼‰
- [ ] è”è°ƒæµ‹è¯•

**ç¬¬äº”æ­¥ï¼šæäº¤ä»£ç **
- [ ] Commit Git
- [ ] å¼€å§‹ä¸‹ä¸€ä¸ªæ¨¡å—

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ30æ—¥  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
